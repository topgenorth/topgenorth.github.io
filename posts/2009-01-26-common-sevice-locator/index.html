<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Common Sevice Locator - Opgenorth.NET</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title=Opgenorth.NET rel=home><div class="logo__item logo__text"><div class=logo__title>Opgenorth.NET</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/posts/><span class=menu__text>Blog</span></a></li><li class=menu__item><a class=menu__link href=/gallery/><span class=menu__text>Travel Gallery</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Common Sevice Locator</h1></header><div class="content post__content clearfix"><p>One of the nice things about <a href=http://martinfowler.com/articles/injection.html>Dependency Injection</a> is that it can really help write a more flexible, modular application.  These days, it seems that there is no shortage of choice in the .NET community when it comes to IoC frameworks:</p><ul><li><a href=http://structuremap.sourceforge.net>StructureMap</a></li><li><a href=http://www.castleproject.org/container/index.html>Castle Windsor</a></li><li><a href=http://www.ninject.org>Ninject</a></li><li><a href=http://code.google.com/p/autofac/>Autofac</a></li><li><a href=http://www.codeplex.com/unity>Unity</a></li><li><a href=http://www.springframework.net/>Spring.NET</a></li><li>And probably others that I&rsquo;m missing.</li></ul><p>Ironically, when you first start using an IoC framework, you might find that in trying to make a loosely-coupled, modular, application you end up shackling yourself to the framework you&rsquo;re using for IoC. For example, you start off using your own homegrown IoC framework, and then decide at some point in the future to use a different framework, like say StructureMap.  Going through your codebase to make these changes can be quite the exercise in pain. There are a couple of ways to isolate yourself from this kind of situation.  I won&rsquo;t get into all of them but instead will focus on the <a href=http://www.codeplex.com/CommonServiceLocator>Common Service Locator</a>.</p><p>What is Common Service Locator?  Well, allow me to cut and paste some text from the web site: &ldquo;<em>The Common Service Locator library contains a shared interface for service location which application and framework developers can reference. The library provides an abstraction over IoC containers and service locators. Using the library allows an application to indirectly access the capabilities without relying on hard references. The hope is that using this library, third-party applications and frameworks can begin to leverage IoC/Service Location without tying themselves down to a specific implementation.</em>&rdquo;</p><p>Blah blah blah - so what does all that mean?  Well, in my own words, CSL is basically a wrapper around your IoC container which separates how you  initialize/configure your IoC container from how you use it.  This separation allows you to use your IoC container without knowing anything about it. This separation is achieved by use of adapters for the particular IoC container that you want to use.  These adapters are what do the dirty work of finding the service you need, in their own special way and totally transparent from your application code.  Currently, the Common Service Locator has adapters for:</p><ul><li><a href="http://www.codeplex.com/CommonServiceLocator/Wiki/View.aspx?title=StructureMap%20Adapter&amp;referringTitle=Home">StructureMap</a></li><li><a href="http://www.codeplex.com/CommonServiceLocator/Wiki/View.aspx?title=Castle%20Windsor%20Adapter&amp;referringTitle=Home">Castle Windows</a></li><li><a href="http://www.codeplex.com/CommonServiceLocator/Wiki/View.aspx?title=Unity%20Adapter&amp;referringTitle=Home">Unity</a></li><li><a href="http://www.codeplex.com/CommonServiceLocator/Wiki/View.aspx?title=Spring%20.NET%20Adapter&amp;referringTitle=Home">Spring.NET</a></li><li><a href="http://www.codeplex.com/CommonServiceLocator/Wiki/View.aspx?title=Autofac%20Adapter&amp;referringTitle=Home">autofac</a>.</li></ul><p>Now, allow me an example of using the Common Service Locator with StructureMap. There is no special reason as to why StructureMap - it just happens to be what I find myself using these days. Now, say I use the the following <a href=http://structuremap.sourceforge.net/RegistryDSL.htm>registry</a> to configure StructureMap:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DefaultStructureMapRegistry</span>: Registry
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>public</span> DefaultStructureMapRegistry()
</span></span><span style=display:flex><span>       {
</span></span><span style=display:flex><span>              ForRequestedType&lt;IDb4oConfiguration&gt;()
</span></span><span style=display:flex><span>                     .TheDefaultIsConcreteType&lt;SimpleDb4oConfiguration&gt;();
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In a nutshell this says that every time StructureMap is asked to provided an object of type IDb4oConfiguration, it should instantiate a SimpleDb4oConfiguration object and return that.  So, to get an instance of IDb4oConfiguration with StructureMap, I would do something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> db4oConfig = ObjectFactory.GetInstance&lt;IDb4oConfiguration&gt;();
</span></span></code></pre></div><p>Pretty simple, but it does kind of tightly couples me to StructureMap.  If I need/feel like/am forced at gunpoint to change my IoC container to something that is Not StructureMap, you can bet that there will be much wailing and gnashing of teeth on my part as I hunt through my code to make these changes. Now enter the Common Service Locator.  First, let&rsquo;s take a peek at some interfaces for CSL.  First an interface:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>namespace</span> Microsoft.Practices.ServiceLocation
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>IServiceLocator</span> : IServiceProvider
</span></span><span style=display:flex><span>     {
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>object</span> GetInstance(Type serviceType);
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>object</span> GetInstance(Type serviceType, <span style=color:#66d9ef>string</span> key);
</span></span><span style=display:flex><span>         IEnumerable&lt;<span style=color:#66d9ef>object</span>&gt; GetAllInstances(Type serviceType);
</span></span><span style=display:flex><span>         TService GetInstance&lt;TService&gt;();
</span></span><span style=display:flex><span>         TService GetInstance&lt;TService&gt;(<span style=color:#66d9ef>string</span> key);
</span></span><span style=display:flex><span>         IEnumerable&lt;TService&gt; GetAllInstances&lt;TService&gt;();
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The <code>IServiceLocator</code> is an interface that your application will use when it requests something from your IoC container. Another thing that CSL provides is a static class that your application would use to use a current <code>IServiceLocator</code> to request services.  That static class looks something like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>namespace</span> Microsoft.Practices.ServiceLocation
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ServiceLocator</span>
</span></span><span style=display:flex><span>       {
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> IServiceLocator Current { <span style=color:#66d9ef>get</span>; }
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> SetLocatorProvider(ServiceLocatorProvider newProvider) {}
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>So, now lets see how we would request the default implementation of the IDb4oConfiguration service using CSL.  First, we would initialize CSL:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> registry = <span style=color:#66d9ef>new</span> DefaultStructureMapRegistry();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> container = <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>global</span>::StructureMap.Container(registry);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> smServiceLocator = <span style=color:#66d9ef>new</span> StructureMapServiceLocator(container);
</span></span><span style=display:flex><span>ServiceLocator.SetLocatorProvider(() =&gt; smServiceLocator );
</span></span></code></pre></div><p>What is going on here? Allow me to provide a quick line by line explanation: Line 1 we instantiate a new StructureMap registry.  We then feed that registry to a StructureMap container in line 2.  With line 3, we see that StructureMap container is then fed to the StructureMapServiceLocator, which is the SM adapter for the Common Service Locator.  Finally, with line 4 we provide a lambda that CSL will use to fulfill future requests for services. Now when our application wants to get an instance of IDb4oConfiguration it just politely asks CSL:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> db4oConfig = ServiceLocator.Current.GetService&lt;IDb4oConfiguration&gt;();
</span></span></code></pre></div><p>Pretty simple and clean, <a href=http://en.wikipedia.org/wiki/Eh#Canada>eh</a>?  Now, when radical group the <em>Foundation for Unity as the Dominate IoC Container</em> sneaks into your cube and forces you at the point of a nerf gun to switch to Unity, you can do so with minimal disruption to your application. With a properly layered application, it would be as simple as coding a new UnityConfiguration layer and then using that instead of your StructureMapConfiguration layer on application startup. Now, granted this is pretty trivialized example.  There are other ways to solve this problem, but CSL does seem to take are of the grunt work for you so that you can just get going with things.</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 000-6 3 3 0 000 6"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/.net/ rel=tag>.NET</a></li></ul></div></footer></article></main></div><aside class=sidebar><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://google.com/search><input class=widget-search__field type=search placeholder=Search… name=q aria-label=Search…>
<input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sitesearch value=https://topgenorth.github.io/></form></div><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/posts/reforming-brass/>Reforming brass for the Mauser 98k</a></li><li class=widget__item><a class=widget__link href=/posts/ballistics-of-norinco-762x51/>Ballistics of Norinco 7.62x51</a></li><li class=widget__item><a class=widget__link href=/posts/ballistics-of-norinco-762x39/>Ballistics of Norinco 7.62x39</a></li><li class=widget__item><a class=widget__link href=/posts/wiring-up-a-nest/>Wiring Up a 2nd Generation Nest</a></li><li class=widget__item><a class=widget__link href=/posts/measure-distance-with-arduino/>Measuring Distance with Arduino</a></li><li class=widget__item><a class=widget__link href=/posts/sublime-text-and-arduino/>Sublime Text 2 and Arduino</a></li><li class=widget__item><a class=widget__link href=/posts/write-gps-to-jpg/>Embed GPS in a JPEG</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>Categories</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/firearms/>Firearms</a></li><li class=widget__item><a class=widget__link href=/categories/personal/>Personal</a></li><li class=widget__item><a class=widget__link href=/categories/programming/>Programming</a></li><li class=widget__item><a class=widget__link href=/categories/technology/>Technology</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>Tags</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/.net/ title=.NET>.NET</a>
<a class="widget-taglist__link widget__link btn" href=/tags/7.62x51/ title=7.62x51>7.62x51</a>
<a class="widget-taglist__link widget__link btn" href=/tags/7.92x57/ title=7.92x57>7.92x57</a>
<a class="widget-taglist__link widget__link btn" href=/tags/alt.net/ title=ALT.NET>ALT.NET</a>
<a class="widget-taglist__link widget__link btn" href=/tags/android/ title=Android>Android</a>
<a class="widget-taglist__link widget__link btn" href=/tags/arduino/ title=Arduino>Arduino</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ballistics/ title=Ballistics>Ballistics</a>
<a class="widget-taglist__link widget__link btn" href=/tags/c%23/ title=C#>C#</a>
<a class="widget-taglist__link widget__link btn" href=/tags/javascript/ title=JavaScript>JavaScript</a>
<a class="widget-taglist__link widget__link btn" href=/tags/linux/ title=Linux>Linux</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mono/ title=Mono>Mono</a>
<a class="widget-taglist__link widget__link btn" href=/tags/rant/ title=Rant>Rant</a>
<a class="widget-taglist__link widget__link btn" href=/tags/reloading/ title=Reloading>Reloading</a>
<a class="widget-taglist__link widget__link btn" href=/tags/samoyed/ title=Samoyed>Samoyed</a>
<a class="widget-taglist__link widget__link btn" href=/tags/tdd/ title=TDD>TDD</a>
<a class="widget-taglist__link widget__link btn" href=/tags/technology/ title=Technology>Technology</a>
<a class="widget-taglist__link widget__link btn" href=/tags/windows/ title=Windows>Windows</a>
<a class="widget-taglist__link widget__link btn" href=/tags/xamarin/ title=Xamarin>Xamarin</a>
<a class="widget-taglist__link widget__link btn" href=/tags/yeg/ title=YEG>YEG</a></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2026 Opgenorth.NET.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>