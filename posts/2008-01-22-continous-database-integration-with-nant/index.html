<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Continous Database Integration With Nant - Opgenorth.NET</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title=Opgenorth.NET rel=home><div class="logo__item logo__text"><div class=logo__title>Opgenorth.NET</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/posts/><span class=menu__text>Blog</span></a></li><li class=menu__item><a class=menu__link href=/gallery/><span class=menu__text>Travel Gallery</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Continous Database Integration With Nant</h1></header><div class="content post__content clearfix"><p>Last night I spent some quality time looking at <a href=http://code.google.com/p/vincent-vega/>vincent-vega</a>, aka Continuous Database Integration for SQL Server. This is a pretty simple and handy task for Nant that helps bring continous integration to your databases. I use updateSqlDatabase like as part of my integration tests like so:</p><ol><li>Drop the database</li><li>Create a new database</li><li>Run some SQL scripts to bring my database up to date</li><li>Run various database integration tests, repeating steps 1 -3 as necessary.</li></ol><p>What this project will add a new task you: updateSqlDatabase. With this task, you can do one of three things: Add a database, Create a Database, and Update a database. updateSqlDatabase will look for SQL script files , and will execute those SQL scripts for you in the order they are found. Information about what scripts have been run are kept in a table that updateSqlDatabase creates for you when you create your database.  This will allow you to see the history of when your database was updated, and with scripts.  This<br>How to get started and use it? First, <a href=http://code.google.com/p/vincent-vega/source>get the code</a> from Google Code. Compile the code. Next copy the output of the build to your Nant bin directory.  See the image below.  You probably won&rsquo;t need log4net.dll or Nant.Core.*.</p><p>Next use the updateSqlDatabase task to perform the drop/create/update as desired. And how do you do that? Well allow me to use athe build from <a href=http://www.codecampserver.org>Code Camp Server</a> as an example. Here are three targets from the nant script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;create-database&#34;</span> <span style=color:#a6e22e>depends=</span><span style=color:#e6db74>&#34;version, init&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;echo</span> <span style=color:#a6e22e>message=</span><span style=color:#e6db74>&#34;Creating database ${database.name}...&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;updateSqlDatabase</span> <span style=color:#a6e22e>scriptDirectory=</span><span style=color:#e6db74>&#34;${database.dir}&#34;</span> <span style=color:#a6e22e>action=</span><span style=color:#e6db74>&#34;Create&#34;</span> <span style=color:#a6e22e>server=</span><span style=color:#e6db74>&#34;${database.server}&#34;</span> <span style=color:#a6e22e>database=</span><span style=color:#e6db74>&#34;${database.name}&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;echo</span> <span style=color:#a6e22e>message=</span><span style=color:#e6db74>&#34;Current Database Version: ${usdDatabaseVersion}&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/target&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;drop-database&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;echo</span> <span style=color:#a6e22e>message=</span><span style=color:#e6db74>&#34;Dropping database ${database.name}...&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;updateSqlDatabase</span> <span style=color:#a6e22e>action=</span><span style=color:#e6db74>&#34;Drop&#34;</span> <span style=color:#a6e22e>database=</span><span style=color:#e6db74>&#34;${database.name}&#34;</span> <span style=color:#a6e22e>server=</span><span style=color:#e6db74>&#34;${database.server}&#34;</span> <span style=color:#a6e22e>failonerror=</span><span style=color:#e6db74>&#34;false&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/target&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;update-database&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;echo</span> <span style=color:#a6e22e>message=</span><span style=color:#e6db74>&#34;Updating database...&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;updateSqlDatabase</span> <span style=color:#a6e22e>scriptDirectory=</span><span style=color:#e6db74>&#34;${database.dir}&#34;</span> <span style=color:#a6e22e>action=</span><span style=color:#e6db74>&#34;Update&#34;</span> <span style=color:#a6e22e>server=</span><span style=color:#e6db74>&#34;${database.server}&#34;</span> <span style=color:#a6e22e>database=</span><span style=color:#e6db74>&#34;${database.name}&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;echo</span> <span style=color:#a6e22e>message=</span><span style=color:#e6db74>&#34;Current Database Version: ${usdDatabaseVersion}&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/target&gt;</span>
</span></span></code></pre></div><p>In these samples, we&rsquo;re assuming integrated security. If you were using SQL authentication, you can, but I&rsquo;m not going to cover that. Look at the code for how to do that.  It&rsquo;s good for you to read other peoples code.  Anyway, here is an explaination of the parameters for the task:</p><ul><li><p>action: one of Add/Update/Drop. Note that this action is also used by updateSqlDatabase to find the script files to run.</p></li><li><p>scriptDirectory: This will hold our database scripts. Note that they must have the .SQL extentsion.  Inside this directory we create one or two folders which will hold our scripts.  So, what are the rules surrounding the locating of SQL script files?  Basically, it goes something like this:<br><em>For a Create action</em>:  get the scripts from first the Create folder (if there is one), and then the scripts from the Update folder.  The scripts in the Create folder get run first, then the scripts from the Update folder.<br><em>For an Update action</em>:  get the scripts from the Update folder.  Run them.<br><em>For the Drop action</em>:  Ignore all the folders.  Don&rsquo;t execute any scripts.</p></li><li><p>server: The database server that the scripts will be run against.</p></li></ul><ul><li>database: The database the scripts will be run against.</li></ul><p>My only complaint about it is that it&rsquo;s SQL Server only (for now). But, I won&rsquo;t complain to loud, as I suppose on the eighth day I could probably add support for MySQL to the project.</p><p>Now, why would I go through all this?  Here is a quick summary of why I think it&rsquo;s worth effort (in case the &lsquo;continous integration&rsquo; didn&rsquo;t give it away):</p><ol><li>It helps me ensure that the database I think I&rsquo;m testing against is the database that I should be testing against.  It minimizes the friction of integration testing when you don&rsquo;t have to chase down and resolve schema or data issues. </li><li>Exercise and test any database scripts that might have to be applied in production. </li><li>I can keep my schema in my source code management tool and manage changes to my database.</li></ol></div></article></main></div><aside class=sidebar><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://google.com/search><input class=widget-search__field type=search placeholder=Search… name=q aria-label=Search…>
<input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sitesearch value=https://topgenorth.github.io/></form></div><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/posts/reforming-brass/>Reforming brass for the Mauser 98k</a></li><li class=widget__item><a class=widget__link href=/posts/ballistics-of-norinco-762x51/>Ballistics of Norinco 7.62x51</a></li><li class=widget__item><a class=widget__link href=/posts/ballistics-of-norinco-762x39/>Ballistics of Norinco 7.62x39</a></li><li class=widget__item><a class=widget__link href=/posts/wiring-up-a-nest/>Wiring Up a 2nd Generation Nest</a></li><li class=widget__item><a class=widget__link href=/posts/measure-distance-with-arduino/>Measuring Distance with Arduino</a></li><li class=widget__item><a class=widget__link href=/posts/sublime-text-and-arduino/>Sublime Text 2 and Arduino</a></li><li class=widget__item><a class=widget__link href=/posts/write-gps-to-jpg/>Embed GPS in a JPEG</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>Categories</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/firearms/>Firearms</a></li><li class=widget__item><a class=widget__link href=/categories/personal/>Personal</a></li><li class=widget__item><a class=widget__link href=/categories/programming/>Programming</a></li><li class=widget__item><a class=widget__link href=/categories/technology/>Technology</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>Tags</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/.net/ title=.NET>.NET</a>
<a class="widget-taglist__link widget__link btn" href=/tags/7.62x51/ title=7.62x51>7.62x51</a>
<a class="widget-taglist__link widget__link btn" href=/tags/7.92x57/ title=7.92x57>7.92x57</a>
<a class="widget-taglist__link widget__link btn" href=/tags/alt.net/ title=ALT.NET>ALT.NET</a>
<a class="widget-taglist__link widget__link btn" href=/tags/android/ title=Android>Android</a>
<a class="widget-taglist__link widget__link btn" href=/tags/arduino/ title=Arduino>Arduino</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ballistics/ title=Ballistics>Ballistics</a>
<a class="widget-taglist__link widget__link btn" href=/tags/c%23/ title=C#>C#</a>
<a class="widget-taglist__link widget__link btn" href=/tags/javascript/ title=JavaScript>JavaScript</a>
<a class="widget-taglist__link widget__link btn" href=/tags/linux/ title=Linux>Linux</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mono/ title=Mono>Mono</a>
<a class="widget-taglist__link widget__link btn" href=/tags/rant/ title=Rant>Rant</a>
<a class="widget-taglist__link widget__link btn" href=/tags/reloading/ title=Reloading>Reloading</a>
<a class="widget-taglist__link widget__link btn" href=/tags/samoyed/ title=Samoyed>Samoyed</a>
<a class="widget-taglist__link widget__link btn" href=/tags/tdd/ title=TDD>TDD</a>
<a class="widget-taglist__link widget__link btn" href=/tags/technology/ title=Technology>Technology</a>
<a class="widget-taglist__link widget__link btn" href=/tags/windows/ title=Windows>Windows</a>
<a class="widget-taglist__link widget__link btn" href=/tags/xamarin/ title=Xamarin>Xamarin</a>
<a class="widget-taglist__link widget__link btn" href=/tags/yeg/ title=YEG>YEG</a></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2026 Opgenorth.NET.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>