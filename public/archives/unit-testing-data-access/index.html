<!DOCTYPE html>
<html>
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><title>opgenorth.net</title></head>
<body>

<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Unit Testing Data Access</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 1 1 0 28 1 1 0 0 1 0-28m0 3a3 3 0 1 0 0 22 3 3 0 0 0 0-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class="meta__text" datetime="2007-09-24T00:00:00Z">2007-09-24</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/Programming/" rel="category">Programming</a>
	</span>
</div></div>
		</header>
		<div class="content post__content clearfix">
			<p>One thing that I don't like about writing tests is some of the jiggery-pokery that goes on with testing database access code. Jiggery-pokery being: ensuring the tables are there, up to date, and are holding the data that they are supposed to hold before and after the test has run. If you don't pay attention to these details, you get a lot of false negatives on your unit tests. This will result in a loss of confidence in your unit tests. When this happens you stop running them, and loose confidence in your ability to refactor without fear.</p>  <p>In my Petshop2Monorail side project I'm working on in my spare time, I decided to see about using an in-memory database for my tests. I would get <a href="http://www.castleproject.org/activerecord/">ActiveRecord</a> to create the database each and every time a test fixture runs. There may (or may not) be some activity involved with populating the database, but at least I have tight control over the database schema and the data I'm working with.</p>  <p>I checked out the <a href="http://www.sqlite.org/">SQLite</a> documentation, and in theory one should be able to use <a href="http://www.sqlite.org/">SQLite</a> as an in-memory database. I couldn't get it to work. I'm not to sure if it's something I'm doing wrong or if it's a limitation of the <a href="http://sqlite.phxsoftware.com">ADO.NET data provider I'm using</a>. For now, I'm willing to turn a blind eye to this shortcoming, and use a file on disk. Yes, I am aware of some of SQLite's other shortcomings (namely concurrency), but for the task at hand I don't think that these shortcomings will negatively manifest themselves.&#160; Yes, I'm aware that I'm having a unit test use a file on disk (something I say you shouldn't do).</p>  <p>The one glitch I ran into was with <a href="http://www.castleproject.org/activerecord">ActiveRecord</a>. I kept getting the error <em>The IDbCommand and IDbConnection implementation in the assembly SQLite.NET could not be found</em>. A quick bit of googling, and <a href="http://sqlite.phxsoftware.com/forums/t/564.aspx">I had my answer</a>. To summarize: There are two ADO.NET drivers for SQLite, and so therefore two NHibernate drivers: <a href="http://adodotnetsqlite.sourceforge.net/">NHibernate.Driver.SQLiteDriver</a> (old) and <a href="http://sqlite.phxsoftware.com/">NHibernate.Driver.SQLite20Driver</a> (new). NHibernate.Driver.SQLite20Driver is what I should have been using.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/.NET/" rel="tag">.NET</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/archives/desert-code-camp-2007-code-powerpoint/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Desert Code Camp 2007 Code &amp; PowerPoint</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/archives/nhibernate-and-parentchild-collections/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">NHibernate and Parent/Child Collections</p>
		</a>
	</div>
</nav>





</body>
</html>
